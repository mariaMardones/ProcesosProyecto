<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataInitializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deustocoches</a> &gt; <a href="index.source.html" class="el_package">com.deustocoches</a> &gt; <span class="el_source">DataInitializer.java</span></div><h1>DataInitializer.java</h1><pre class="source lang-java linenums">package com.deustocoches;

import java.util.List;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.transaction.annotation.Transactional;

import com.deustocoches.model.Coche;
import com.deustocoches.model.EstadoReserva;
import com.deustocoches.model.Reserva;
import com.deustocoches.model.TipoRol;
import com.deustocoches.model.Usuario;
import com.deustocoches.repository.CocheRepository;
import com.deustocoches.repository.ReservaRepository;
import com.deustocoches.repository.UsuarioRepository;

@Configuration
<span class="fc" id="L21">public class DataInitializer {</span>

<span class="fc" id="L23">    private static final Logger logger = LoggerFactory.getLogger(DataInitializer.class);</span>

    @Bean
    @Transactional
    CommandLineRunner initData(
            UsuarioRepository usuarioRepo,
            CocheRepository cocheRepo,
            ReservaRepository reservaRepo) {
<span class="fc" id="L31">        return args -&gt; {</span>
            // Elimina todo solo si las tablas están vacías
<span class="pc bpc" id="L33" title="2 of 6 branches missed.">            if (usuarioRepo.count() == 0 &amp;&amp; cocheRepo.count() == 0 &amp;&amp; reservaRepo.count() == 0) {</span>
<span class="fc" id="L34">                reservaRepo.deleteAll();</span>
<span class="fc" id="L35">                usuarioRepo.deleteAll();</span>
<span class="fc" id="L36">                cocheRepo.deleteAll();</span>

                // Inicialización de usuarios
<span class="fc" id="L39">                Usuario admin = new Usuario(&quot;Admin&quot;, &quot;Principal&quot;, &quot;1980-01-01&quot;, &quot;admin@deusto.com&quot;, &quot;adminpass&quot;, &quot;600000001&quot;);</span>
<span class="fc" id="L40">                Usuario cliente1 = new Usuario(&quot;Juan&quot;, &quot;Pérez&quot;, &quot;1990-05-15&quot;, &quot;juanperez@gmail.com&quot;, &quot;password1&quot;, &quot;600000002&quot;);</span>
<span class="fc" id="L41">                Usuario cliente2 = new Usuario(&quot;Ana&quot;, &quot;López&quot;, &quot;1985-10-20&quot;, &quot;analopez@gmail.com&quot;, &quot;password2&quot;, &quot;600000003&quot;);</span>
<span class="fc" id="L42">                Usuario cliente3 = new Usuario(&quot;Lucía&quot;, &quot;Martínez&quot;, &quot;1992-07-22&quot;, &quot;lucia.martinez@gmail.com&quot;, &quot;password4&quot;, &quot;600000005&quot;);</span>
<span class="fc" id="L43">                Usuario clienteBloqueado = new Usuario(&quot;Carlos&quot;, &quot;Ruiz&quot;, &quot;1995-03-10&quot;, &quot;carlosruiz@gmail.com&quot;, &quot;password3&quot;, &quot;600000004&quot;);</span>
                
<span class="fc" id="L45">                clienteBloqueado.setBloqueado(true); </span>
<span class="fc" id="L46">                admin.setRol(TipoRol.ADMIN);</span>

<span class="fc" id="L48">                usuarioRepo.saveAll(List.of(admin, cliente1, cliente2, cliente3, clienteBloqueado));</span>
<span class="fc" id="L49">                logger.info(&quot;Usuarios guardados!&quot;);</span>

                // Inicialización de coches (20 coches, 15 disponibles, marcas/modelos repetidos)
<span class="fc" id="L52">                Coche coche1 = new Coche(&quot;1234ABC&quot;, &quot;Toyota&quot;, &quot;Corolla&quot;, 2020, &quot;Blanco&quot;, 4000.0, true);</span>
<span class="fc" id="L53">                Coche coche2 = new Coche(&quot;5678DEF&quot;, &quot;Ford&quot;, &quot;Focus&quot;, 2019, &quot;Negro&quot;, 2999.99, true);</span>
<span class="fc" id="L54">                Coche coche3 = new Coche(&quot;9012GHI&quot;, &quot;Volkswagen&quot;, &quot;Golf&quot;, 2021, &quot;Rojo&quot;, 10000.0, false);</span>
<span class="fc" id="L55">                Coche coche4 = new Coche(&quot;3456JKL&quot;, &quot;Seat&quot;, &quot;Ibiza&quot;, 2018, &quot;Azul&quot;, 3000.5, true);</span>
<span class="fc" id="L56">                Coche coche5 = new Coche(&quot;7890MNO&quot;, &quot;Toyota&quot;, &quot;Corolla&quot;, 2022, &quot;Gris&quot;, 12000.0, true);</span>
<span class="fc" id="L57">                Coche coche6 = new Coche(&quot;2468PQR&quot;, &quot;Ford&quot;, &quot;Focus&quot;, 2020, &quot;Blanco&quot;, 8500.0, true);</span>
<span class="fc" id="L58">                Coche coche7 = new Coche(&quot;1357STU&quot;, &quot;Volkswagen&quot;, &quot;Golf&quot;, 2017, &quot;Negro&quot;, 7000.0, true);</span>
<span class="fc" id="L59">                Coche coche8 = new Coche(&quot;1122VWX&quot;, &quot;Seat&quot;, &quot;Ibiza&quot;, 2019, &quot;Rojo&quot;, 5000.0, true);</span>
<span class="fc" id="L60">                Coche coche9 = new Coche(&quot;3344YZA&quot;, &quot;Renault&quot;, &quot;Clio&quot;, 2016, &quot;Azul&quot;, 4500.0, false);</span>
<span class="fc" id="L61">                Coche coche10 = new Coche(&quot;5566BCD&quot;, &quot;Peugeot&quot;, &quot;208&quot;, 2021, &quot;Blanco&quot;, 9500.0, true);</span>
<span class="fc" id="L62">                Coche coche11 = new Coche(&quot;7788EFG&quot;, &quot;Toyota&quot;, &quot;Corolla&quot;, 2018, &quot;Negro&quot;, 6000.0, true);</span>
<span class="fc" id="L63">                Coche coche12 = new Coche(&quot;9900HIJ&quot;, &quot;Ford&quot;, &quot;Focus&quot;, 2015, &quot;Gris&quot;, 3500.0, false);</span>
<span class="fc" id="L64">                Coche coche13 = new Coche(&quot;2233KLM&quot;, &quot;Volkswagen&quot;, &quot;Golf&quot;, 2022, &quot;Azul&quot;, 15000.0, true);</span>
<span class="fc" id="L65">                Coche coche14 = new Coche(&quot;4455NOP&quot;, &quot;Seat&quot;, &quot;Ibiza&quot;, 2020, &quot;Blanco&quot;, 8000.0, true);</span>
<span class="fc" id="L66">                Coche coche15 = new Coche(&quot;6677QRS&quot;, &quot;Renault&quot;, &quot;Clio&quot;, 2017, &quot;Rojo&quot;, 4800.0, true);</span>
<span class="fc" id="L67">                Coche coche16 = new Coche(&quot;8899TUV&quot;, &quot;Peugeot&quot;, &quot;208&quot;, 2019, &quot;Negro&quot;, 7200.0, true);</span>
<span class="fc" id="L68">                Coche coche17 = new Coche(&quot;1011WXY&quot;, &quot;Toyota&quot;, &quot;Corolla&quot;, 2021, &quot;Azul&quot;, 11000.0, true);</span>
<span class="fc" id="L69">                Coche coche18 = new Coche(&quot;1213ZAB&quot;, &quot;Ford&quot;, &quot;Focus&quot;, 2016, &quot;Blanco&quot;, 4000.0, false);</span>
<span class="fc" id="L70">                Coche coche19 = new Coche(&quot;1415CDE&quot;, &quot;Volkswagen&quot;, &quot;Golf&quot;, 2018, &quot;Gris&quot;, 8000.0, true);</span>
<span class="fc" id="L71">                Coche coche20 = new Coche(&quot;1617FGH&quot;, &quot;Seat&quot;, &quot;Ibiza&quot;, 2022, &quot;Negro&quot;, 13000.0, true);</span>
<span class="fc" id="L72">                coche1.setDescuento(10);</span>
<span class="fc" id="L73">                coche5.setDescuento(5);</span>
<span class="fc" id="L74">                coche10.setDescuento(15);</span>
<span class="fc" id="L75">                coche13.setDescuento(20);</span>
<span class="fc" id="L76">                coche17.setDescuento(8);</span>
<span class="fc" id="L77">                cocheRepo.saveAll(List.of(</span>
                    coche1, coche2, coche3, coche4, coche5, coche6, coche7, coche8, coche9, coche10,
                    coche11, coche12, coche13, coche14, coche15, coche16, coche17, coche18, coche19, coche20
                ));
<span class="fc" id="L81">                logger.info(&quot;Coches guardados!&quot;);</span>

                // Inicialización de reservas (al menos una por cliente, algunas más)
<span class="fc" id="L84">                Reserva reserva1 = new Reserva(cliente1, coche1, &quot;2025-05-10&quot;, 4000.0, EstadoReserva.COMPRADA);</span>
<span class="fc" id="L85">                Reserva reserva2 = new Reserva(cliente2, coche2, &quot;2025-05-12&quot;, 2999.99, EstadoReserva.PENDIENTE);</span>
<span class="fc" id="L86">                Reserva reserva3 = new Reserva(cliente1, coche3, &quot;2025-05-15&quot;, 10000.0, EstadoReserva.CANCELADA);</span>
<span class="fc" id="L87">                Reserva reserva4 = new Reserva(cliente3, coche5, &quot;2025-06-01&quot;, 12000.0, EstadoReserva.PENDIENTE);</span>
<span class="fc" id="L88">                Reserva reserva5 = new Reserva(cliente2, coche14, &quot;2025-06-15&quot;, 8000.0, EstadoReserva.PENDIENTE);</span>
<span class="fc" id="L89">                Reserva reserva6 = new Reserva(cliente3, coche11, &quot;2025-06-20&quot;, 6000.0, EstadoReserva.COMPRADA);</span>

<span class="fc" id="L91">                reservaRepo.saveAll(List.of(reserva1, reserva2, reserva3, reserva4, reserva5, reserva6));</span>
<span class="fc" id="L92">                logger.info(&quot;Reservas guardadas!&quot;);</span>
            }
<span class="fc" id="L94">        };</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>